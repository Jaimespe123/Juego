<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Car vs Zombies - Conduce, derrapa y esquiva hordas de zombies">
  <meta name="theme-color" content="#1a2a36">
  <title>Car vs Zombies â€“ Juego de AcciÃ³n Ultra</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://unpkg.com">
</head>
<body>
  <div id="container" role="main">
    <!-- Fondo animado de partÃ­culas -->
    <canvas id="bgCanvas" class="bg-canvas"></canvas>
    
    <!-- HUD del juego -->
    <aside id="hud" aria-label="EstadÃ­sticas del juego">
      <div class="stat">
        <div><span class="label">FPS</span></div>
        <div id="fps" style="font-family: monospace;">60</div>
      </div>
      <div class="stat">
        <div><span class="label">PuntuaciÃ³n</span></div>
        <div id="score" aria-live="polite">0</div>
      </div>
      <div class="stat">
        <div><span class="label">Vida</span></div>
        <div id="hp" aria-live="polite">100</div>
      </div>
      <div class="stat">
        <div><span class="label">Velocidad</span></div>
        <div id="speed" aria-live="polite">0 km/h</div>
      </div>
      <div class="stat">
        <div><span class="label">Monedas</span></div>
        <div id="coins" aria-live="polite">0</div>
      </div>
      <div class="stat">
        <div><span class="label">Combo</span></div>
        <div id="combo" style="color: #ff6600; font-weight: bold; display: none;">x1</div>
      </div>
      <div class="stat">
        <div><span class="label">Oleada</span></div>
        <div id="wave">1</div>
      </div>
      <div class="stat">
        <div><span class="label">MisiÃ³n</span></div>
        <div id="mission" class="mission-text">-</div>
      </div>
      <div class="stat nitro-stat">
        <div class="nitro-label">Nitro</div>
        <div class="nitro-track">
          <div id="nitroBar" class="nitro-bar"></div>
        </div>
      </div>
      <!-- MEDIDOR DE DERRAPE -->
      <div class="stat nitro-stat">
        <div class="nitro-label" id="driftMeterLabel">Deriva 0%</div>
        <div class="nitro-track">
          <div id="driftMeterBar" class="nitro-bar" style="background:#ff6600; width:0%;"></div>
        </div>
      </div>
      <!-- MINAS -->
      <div class="stat" id="mineHudStat" style="display:none">
        <div id="mineCount" style="color:#ff4400; font-weight:bold;">ğŸ’£ Ã—0</div>
      </div>
      <div class="stat">
        <div><span class="label">Tiempo</span></div>
        <div id="playTime" style="font-family:monospace;">0:00</div>
      </div>
      <div class="stat">
        <div><span class="label">Distancia</span></div>
        <div id="distanceTraveled" style="font-family:monospace;">0 m</div>
      </div>
    </aside>

    <!-- Power-ups activos -->
    <div id="powerupContainer" class="powerup-container">
      <!-- Los power-ups activos aparecerÃ¡n aquÃ­ -->
    </div>

    <!-- Mini-mapa (Inferior Derecha) -->
    <canvas id="minimap" width="160" height="160" 
            style="position: absolute; bottom: 12px; right: 12px; z-index: 45; 
                   border: 3px solid var(--accent); border-radius: 12px; 
                   background: rgba(10, 14, 20, 0.95); box-shadow: var(--shadow-lg);">
    </canvas>

    <!-- Controles superiores -->
    <nav id="topRight" aria-label="Controles del juego">
      <button class="btn" id="btnSettings" aria-label="Abrir ajustes">
        <span aria-hidden="true">âš™ï¸</span> Ajustes
      </button>
      <button class="btn primary" id="btnOpenMenu" aria-label="Abrir menÃº principal">
        ğŸ“‹ MenÃº
      </button>
      <button class="btn warn" id="btnRestart" style="display:none" aria-label="Reiniciar partida">
        ğŸ”„ Reiniciar
      </button>
    </nav>

    <!-- MENÃš PRINCIPAL MEJORADO -->
    <section id="overlayMenu" class="overlay hero-menu" role="dialog" aria-labelledby="menuTitle" aria-modal="true">
      <!-- Efecto de fondo con lÃ­neas de carretera -->
      <div class="road-lines"></div>
      
      <div class="hero-content">
        <!-- Logo del juego con efecto neÃ³n -->
        <div class="game-logo">
          <div class="logo-icon">ğŸš—</div>
          <h1 id="menuTitle" class="neon-text">
            CAR VS ZOMBIES
            <span class="ultra-badge">ULTRA</span>
          </h1>
          <p class="tagline">
            <span class="typing-text">Conduce, derrapa y sobrevive...</span>
          </p>
        </div>

        <!-- EstadÃ­sticas rÃ¡pidas -->
        <div class="quick-stats">
          <div class="stat-card">
            <div class="stat-icon">ğŸ†</div>
            <div class="stat-value" id="menuBestScore">0</div>
            <div class="stat-label">RÃ©cord</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-value" id="menuCoins">0</div>
            <div class="stat-label">Monedas</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ®</div>
            <div class="stat-value" id="menuGames">0</div>
            <div class="stat-label">Partidas</div>
          </div>
        </div>
        
        <!-- Botones principales con efectos -->
        <div class="menu-actions">
          <button class="btn-hero primary pulse" id="startBtn">
            <span class="btn-icon">â–¶ï¸</span>
            <span class="btn-text">EMPEZAR PARTIDA</span>
            <span class="btn-glow"></span>
          </button>
          
          <div class="menu-grid">
            <button class="btn-hero secondary" id="openShop">
              <span class="btn-icon">ğŸ›’</span>
              <span class="btn-text">Tienda</span>
            </button>
            <button class="btn-hero secondary" id="openZombieInfo">
              <span class="btn-icon">ğŸ§Ÿ</span>
              <span class="btn-text">Zombies</span>
            </button>
            <button class="btn-hero secondary" id="openLeaderboard">
              <span class="btn-icon">ğŸ†</span>
              <span class="btn-text">Records</span>
            </button>
            <button class="btn-hero secondary" id="openSettings">
              <span class="btn-icon">âš™ï¸</span>
              <span class="btn-text">Ajustes</span>
            </button>
            <button class="btn-hero secondary" id="openTutorial">
              <span class="btn-icon">ğŸ“˜</span>
              <span class="btn-text">Tutorial</span>
            </button>
            <button class="btn-hero secondary" id="openDifficulty">
              <span class="btn-icon">âš”ï¸</span>
              <span class="btn-text">Dificultad</span>
            </button>
          </div>
        </div>
        
        <!-- Controles compactos -->
        <div class="controls-compact">
          <div class="control-tip">
            <kbd>WASD</kbd> <span>Movimiento</span>
          </div>
          <div class="control-tip">
            <kbd>MOUSE</kbd> <span>DirecciÃ³n</span>
          </div>
          <div class="control-tip">
            <kbd>SHIFT</kbd> <span>Drift</span>
          </div>
          <div class="control-tip">
            <kbd>N</kbd> <span>Nitro</span>
          </div>
          <div class="control-tip">
            <kbd>Q</kbd> <span>Onda de choque</span>
          </div>
          <div class="control-tip">
            <kbd>F</kbd> <span>Soltar mina</span>
          </div>
        </div>


        <div class="daily-mission-card" id="dailyMissionCard">
          <h3>ğŸ“… MisiÃ³n diaria</h3>
          <p id="dailyMissionText">-</p>
          <button class="btn primary" id="claimDailyMission" disabled>Reclamar recompensa</button>
        </div>

        <!-- Footer con versiÃ³n -->
        <div class="menu-footer">
          <div class="version">Version ULTRA v2.0</div>
          <div class="credit">ğŸ® Mejor en Desktop â€¢ <kbd>F11</kbd> Pantalla Completa</div>
        </div>
      </div>
    </section>

    <!-- TIENDA DE COLORES Y MEJORAS -->
    <section id="overlayShop" class="overlay shop-overlay" style="display:none" role="dialog" aria-labelledby="shopTitle" aria-modal="true">
      <div class="shop-header">
        <h1 id="shopTitle">ğŸ›’ Tienda & Mejoras</h1>
        <p class="shop-subtitle">Personaliza tu coche y potencia tu build para llegar mÃ¡s lejos en cada run.</p>
      </div>

      <div class="shop-balance">
        <p>
          <strong>ğŸ’° Tus Monedas:</strong>
          <span id="shopCoinsDisplay" class="coins-amount">0</span>
        </p>
      </div>

      <div id="shopInsights" class="shop-insights" aria-live="polite"></div>

      <h2 class="shop-section-title">ğŸ¨ Colores</h2>
      <div id="shopGrid" class="shop-grid" role="list" aria-label="Colores disponibles">
        <!-- Los colores se generan dinÃ¡micamente aquÃ­ -->
      </div>

      <h2 class="shop-section-title">â¬†ï¸ Mejoras Permanentes</h2>
      <p class="shop-note">Las mejoras son permanentes y se aplican a todas tus partidas.</p>
      <div id="upgradesGrid" class="upgrades-grid">
        <!-- Las mejoras se generan dinÃ¡micamente aquÃ­ -->
      </div>

      <div class="shop-actions">
        <button class="btn large" id="backFromShop">
          â—€ï¸ Volver al MenÃº
        </button>
      </div>
    </section>

    <!-- INFORMACIÃ“N DE ZOMBIES -->
    <section id="overlayZombieInfo" class="overlay" style="display:none; max-width: 700px;" role="dialog" aria-labelledby="zombieInfoTitle" aria-modal="true">
      <h1 id="zombieInfoTitle">ğŸ§Ÿ Tipos de Zombies</h1>
      
      <p style="color: var(--muted); font-size: 14px; margin-bottom: 20px;">
        Conoce a tus enemigos y sus caracterÃ­sticas
      </p>

      <div class="zombie-info-grid">
        <!-- Zombie Normal -->
        <div class="zombie-info-card" style="border-color: #2d5a2d;">
          <div class="zombie-icon" style="background: #2d5a2d;">ğŸ§Ÿ</div>
          <h3 style="color: #2d5a2d;">Zombie Normal</h3>
          <div class="zombie-stats">
            <div class="stat-row">
              <span class="stat-label">Velocidad:</span>
              <span class="stat-value">â­â­â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Vida:</span>
              <span class="stat-value">â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">DaÃ±o:</span>
              <span class="stat-value">12 HP</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Puntos:</span>
              <span class="stat-value">10 pts</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Monedas:</span>
              <span class="stat-value">ğŸ’° 1</span>
            </div>
          </div>
          <p class="zombie-desc">
            El zombie estÃ¡ndar. Velocidad y daÃ±o moderados. Perfecto para practicar combos.
          </p>
        </div>

        <!-- Zombie RÃ¡pido -->
        <div class="zombie-info-card" style="border-color: #ff6600;">
          <div class="zombie-icon" style="background: #ff6600;">ğŸ§Ÿâ€â™‚ï¸</div>
          <h3 style="color: #ff6600;">Zombie RÃ¡pido</h3>
          <div class="zombie-stats">
            <div class="stat-row">
              <span class="stat-label">Velocidad:</span>
              <span class="stat-value">â­â­â­â­â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Vida:</span>
              <span class="stat-value">â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">DaÃ±o:</span>
              <span class="stat-value">8 HP</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Puntos:</span>
              <span class="stat-value">20 pts</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Monedas:</span>
              <span class="stat-value">ğŸ’° 2</span>
            </div>
          </div>
          <p class="zombie-desc">
            Muy rÃ¡pido pero frÃ¡gil. DifÃ­cil de alcanzar, pero vale mÃ¡s puntos.
          </p>
        </div>

        <!-- Zombie Tanque -->
        <div class="zombie-info-card" style="border-color: #8b0000;">
          <div class="zombie-icon" style="background: #8b0000;">ğŸ§Ÿâ€â™€ï¸</div>
          <h3 style="color: #8b0000;">Zombie Tanque</h3>
          <div class="zombie-stats">
            <div class="stat-row">
              <span class="stat-label">Velocidad:</span>
              <span class="stat-value">â­â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Vida:</span>
              <span class="stat-value">â­â­â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">DaÃ±o:</span>
              <span class="stat-value">25 HP</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Puntos:</span>
              <span class="stat-value">50 pts</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Monedas:</span>
              <span class="stat-value">ğŸ’° 5</span>
            </div>
          </div>
          <p class="zombie-desc">
            <strong>Â¡PELIGROSO!</strong> Lento pero resistente. Necesita 3 golpes para morir. Hace mucho daÃ±o.
          </p>
        </div>

        <!-- Zombie Explosivo -->
        <div class="zombie-info-card" style="border-color: #ffff00;">
          <div class="zombie-icon" style="background: #ffff00; color: #000;">ğŸ’£</div>
          <h3 style="color: #ffff00;">Zombie Explosivo</h3>
          <div class="zombie-stats">
            <div class="stat-row">
              <span class="stat-label">Velocidad:</span>
              <span class="stat-value">â­â­â­â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Vida:</span>
              <span class="stat-value">â­</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">DaÃ±o:</span>
              <span class="stat-value">30 HP</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Puntos:</span>
              <span class="stat-value">40 pts</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Monedas:</span>
              <span class="stat-value">ğŸ’° 3</span>
            </div>
          </div>
          <p class="zombie-desc">
            <strong>âš ï¸ Â¡CUIDADO!</strong> Explota al morir o al chocar. MantÃ©n tu distancia o usa el escudo.
          </p>
        </div>
      </div>

      <div class="zombie-tips">
        <h3>ğŸ’¡ Consejos de Combate</h3>
        <ul>
          <li><strong>Zombies Normales:</strong> Ãšsalos para mantener tu combo alto</li>
          <li><strong>Zombies RÃ¡pidos:</strong> Prioriza esquivarlos, valen muchos puntos</li>
          <li><strong>Zombies Tanque:</strong> Usa el arma o evÃ­talos si no tienes escudo</li>
          <li><strong>Zombies Explosivos:</strong> Â¡NUNCA los mates de frente! Usa el arma desde lejos</li>
        </ul>
      </div>

      <div class="shop-actions">
        <button class="btn large" id="backFromZombieInfo">
          â—€ï¸ Volver al MenÃº
        </button>
      </div>
    </section>

    <!-- TABLA DE CLASIFICACIÃ“N -->
    <section id="overlayLeaderboard" class="overlay" style="display:none; max-width: 700px;" role="dialog" aria-labelledby="leaderboardTitle" aria-modal="true">
      <h1 id="leaderboardTitle">ğŸ† Tabla de ClasificaciÃ³n</h1>
      
      <p style="color: var(--muted); font-size: 14px; margin-bottom: 12px;">
        Top 10 mejores puntuaciones con detalles de partida
      </p>

      <div id="leaderboardSummary" class="leaderboard-summary"></div>

      <div class="leaderboard-controls">
        <button class="btn" id="sortByScore">Score</button>
        <button class="btn" id="sortByKills">Kills</button>
        <button class="btn" id="sortByWave">Oleada</button>
      </div>

      <div id="leaderboardAchievements" class="leaderboard-achievements"></div>

      <div id="leaderboardContent" style="min-height: 260px;">
        <!-- Las entradas se generan dinÃ¡micamente -->
      </div>

      <div class="shop-actions" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button class="btn warn" id="clearLeaderboard">ğŸ§¹ Limpiar rÃ©cords</button>
        <button class="btn large" id="backFromLeaderboard">
          â—€ï¸ Volver al MenÃº
        </button>
      </div>
    </section>


    <!-- TUTORIAL INTERACTIVO -->
    <section id="overlayTutorial" class="overlay" style="display:none; max-width: 760px;" role="dialog" aria-labelledby="tutorialTitle" aria-modal="true">
      <h1 id="tutorialTitle">ğŸ“˜ Tutorial interactivo</h1>
      <p style="color: var(--muted); font-size: 14px;">Aprende lo esencial en 3 pasos para dominar coche, nitro y combate.</p>

      <div class="daily-mission-card">
        <h3 id="tutorialStepTitle">Paso 1</h3>
        <p id="tutorialStepText">Pulsa Shift mientras giras para derrapar.</p>
      </div>

      <div class="shop-actions" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button class="btn primary large" id="startTutorialRun">â–¶ï¸ Iniciar tutorial</button>
        <button class="btn large" id="nextTutorialStep">Siguiente paso</button>
        <button class="btn" id="backFromTutorial">â—€ï¸ Volver al menÃº</button>
      </div>
    </section>

    <!-- GAME OVER -->
    <section id="overlayGameOver" class="overlay" style="display:none" role="dialog" aria-labelledby="goTitle" aria-modal="true">
      <h1 id="goTitle">Game Over</h1>
      
      <div class="game-over-stats">
        <p class="final-score">
          PuntuaciÃ³n final: <strong id="goScore">0</strong>
        </p>
        <p class="coins-earned">
          ğŸ’° Monedas ganadas: <strong id="goCoins">0</strong>
        </p>
        <p style="color: var(--muted); font-size: 14px;">
          ğŸ¯ Kills totales: <strong id="goKills" style="color: #ff6600;">0</strong>
        </p>
        <p style="color: var(--muted); font-size: 14px;">
          ğŸ”¥ Combo mÃ¡ximo: <strong id="goMaxCombo" style="color: #ff6600;">x1</strong>
        </p>
      </div>
      
      <div class="game-over-actions">
        <button class="btn primary large" id="playAgain">
          ğŸ”„ Jugar otra vez
        </button>
        <button class="btn large" id="toMenu">
          ğŸ“‹ Volver al menÃº
        </button>
      </div>
    </section>

    <!-- PANEL DE AJUSTES -->
    <aside id="settingsPanel" role="dialog" aria-labelledby="settingsTitle" style="display:none">
      <h3 id="settingsTitle">âš™ï¸ Ajustes</h3>
      
      <div class="settings-group">
        <div class="setting">
          <label for="volMaster">
            ğŸ”Š Volumen maestro
            <span id="volMasterVal" class="setting-value">80%</span>
          </label>
          <input 
            id="volMaster" 
            type="range" 
            min="0" 
            max="1" 
            step="0.01" 
            value="0.8"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="80">
        </div>
        
        <div class="setting">
          <label for="volEngine">
            ğŸï¸ Volumen motor
            <span id="volEngineVal" class="setting-value">80%</span>
          </label>
          <input 
            id="volEngine" 
            type="range" 
            min="0" 
            max="1" 
            step="0.01" 
            value="0.8"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="80">
        </div>
        
        <div class="setting">
          <label for="volSfx">
            ğŸ’¥ Volumen efectos
            <span id="volSfxVal" class="setting-value">90%</span>
          </label>
          <input 
            id="volSfx" 
            type="range" 
            min="0" 
            max="1" 
            step="0.01" 
            value="0.9"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="90">
        </div>
        

        <div class="setting">
          <label for="steeringMode">
            ğŸ® Suavizado de giro
          </label>
          <select id="steeringMode" class="setting-select">
            <option value="soft">Suave</option>
            <option value="normal" selected>Normal</option>
            <option value="direct">Directo</option>
          </select>
        </div>

        <div class="setting">
          <label for="nightLightBoost">
            ğŸŒ™ Intensidad farolas
            <span id="nightLightBoostVal" class="setting-value">120%</span>
          </label>
          <input
            id="nightLightBoost"
            type="range"
            min="0.8"
            max="2"
            step="0.1"
            value="1.2"
            aria-valuemin="80"
            aria-valuemax="200"
            aria-valuenow="120">
        </div>

        <div class="setting">
          <label for="graphicsQuality">
            ğŸ® Calidad grÃ¡fica
          </label>
          <select id="graphicsQuality" class="setting-select">
            <option value="ultra">Ultra âœ¨ â€” mÃ¡xima calidad</option>
            <option value="high" selected>Alto ğŸ”¥ â€” recomendado</option>
            <option value="medium">Medio âš¡ â€” mÃ¡s fluido</option>
            <option value="low">Bajo ğŸ¢ â€” PCs lentos</option>
            <option value="potato">Patata ğŸ¥” â€” rendimiento mÃ¡ximo</option>
          </select>
          <p style="font-size:11px;color:var(--muted);margin-top:4px;">
            Los modos Bajo y Patata aumentan el tamaÃ±o de pÃ­xel para ganar muchos FPS.
          </p>
        </div>
      </div>
      
      <div class="settings-actions">
        <button class="btn" id="closeSettings">Cerrar</button>
      </div>
    </aside>

    <!-- Mensaje flotante en juego -->
    <div id="inGameMsg" role="status" aria-live="polite"></div>

    <!-- BARRA DE VIDA DEL BOSS -->
    <div id="bossHealthBar" style="display:none; position:absolute; top:18px; left:50%; transform:translateX(-50%); z-index:50; text-align:center; min-width:320px;">
      <div id="bossName" style="font-size:14px; font-weight:900; color:#ff2244; text-shadow:0 0 12px #ff2244; letter-spacing:2px; margin-bottom:5px;">ğŸ‘¹ ZOMBIE BOSS</div>
      <div style="background:rgba(10,14,20,0.9); border:2px solid #ff2244; border-radius:8px; padding:4px 8px; box-shadow:0 0 20px rgba(255,34,68,0.4);">
        <div style="background:#1a0a0a; border-radius:4px; overflow:hidden; height:20px;">
          <div id="bossHpFill" style="height:100%; width:100%; background:linear-gradient(90deg,#ff0022,#ff6600); transition:width 0.3s ease; border-radius:4px; position:relative;">
            <div id="bossHpText" style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:bold; color:white; text-shadow:1px 1px 2px #000;">100%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- PANTALLA DE PAUSA -->
    <div id="pauseScreen" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); z-index:200; align-items:center; justify-content:center; backdrop-filter:blur(4px);">
      <div style="background:rgba(20,30,45,0.98); border:2px solid rgba(29,185,84,0.4); border-radius:16px; padding:40px; text-align:center; max-width:380px; width:90%; box-shadow:0 0 60px rgba(0,0,0,0.8);">
        <div style="font-size:48px; margin-bottom:8px;">â¸ï¸</div>
        <h2 style="margin:0 0 6px; color:#1db954; font-size:28px; letter-spacing:2px;">PAUSA</h2>
        <p style="color:#bfc8d0; margin:0 0 24px; font-size:13px;">Pulsa ESC o el botÃ³n para reanudar</p>
        <div style="display:flex; flex-direction:column; gap:10px;">
          <button class="btn primary large" id="resumeBtn" style="font-size:16px; padding:14px 24px;">â–¶ï¸ Reanudar</button>
          <button class="btn large" id="pauseRestartBtn" style="font-size:15px; padding:12px 24px;">ğŸ”„ Reiniciar</button>
          <button class="btn large" id="pauseMenuBtn" style="font-size:15px; padding:12px 24px;">ğŸ“‹ MenÃº principal</button>
        </div>
        <div style="margin-top:20px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.08); font-size:12px; color:#7a8a9a;">
          <span>Oleada: <strong id="pauseWave">1</strong></span> &nbsp;Â·&nbsp;
          <span>Puntos: <strong id="pauseScore">0</strong></span> &nbsp;Â·&nbsp;
          <span>HP: <strong id="pauseHp">100</strong></span>
        </div>
      </div>
    </div>

    <!-- PANEL ROGUELIKE ENTRE OLEADAS -->
    <div id="waveUpgradePanel" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.82); z-index:210; align-items:center; justify-content:center; backdrop-filter:blur(6px);">
      <div style="background:rgba(15,22,35,0.98); border:2px solid rgba(29,185,84,0.5); border-radius:20px; padding:36px 28px; text-align:center; max-width:620px; width:95%; box-shadow:0 0 80px rgba(29,185,84,0.2);">
        <div style="font-size:36px; margin-bottom:4px;">ğŸŒŠ</div>
        <h2 id="waveUpgradeTitle" style="margin:0 0 4px; color:#1db954; font-size:22px; letter-spacing:1px;">Â¡OLEADA COMPLETADA!</h2>
        <p style="color:#bfc8d0; margin:0 0 24px; font-size:13px;">Elige una mejora para esta partida:</p>
        <div id="waveUpgradeOptions" style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-bottom:20px;"></div>
        <p style="color:#7a8a9a; font-size:11px;">La elecciÃ³n es permanente para esta run</p>
      </div>
    </div>

    <!-- NOTIFICACIÃ“N DE LOGRO -->
    <div id="achievementPopup" style="display:none; position:fixed; bottom:80px; right:16px; z-index:300; background:linear-gradient(135deg,rgba(20,30,45,0.98),rgba(30,45,65,0.98)); border:2px solid #ffdd00; border-radius:12px; padding:14px 18px; max-width:280px; box-shadow:0 0 30px rgba(255,221,0,0.3); transform:translateX(320px); transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);">
      <div style="display:flex; align-items:center; gap:10px;">
        <div style="font-size:28px;">ğŸ…</div>
        <div>
          <div style="font-size:11px; color:#ffdd00; font-weight:700; letter-spacing:1px; text-transform:uppercase; margin-bottom:2px;">Logro desbloqueado</div>
          <div id="achievementTitle" style="font-size:14px; font-weight:bold; color:#e6eef6;"></div>
          <div id="achievementDesc" style="font-size:11px; color:#bfc8d0; margin-top:2px;"></div>
        </div>
      </div>
    </div>

    <!-- JOYSTICK VIRTUAL MÃ“VIL -->
    <div id="mobileControls" style="display:none; position:fixed; bottom:0; left:0; right:0; z-index:100; pointer-events:none;">
      <div id="joystickZone" style="position:absolute; bottom:20px; left:20px; width:120px; height:120px; pointer-events:all;">
        <div style="width:120px; height:120px; border-radius:50%; background:rgba(255,255,255,0.08); border:2px solid rgba(255,255,255,0.2); position:relative;">
          <div id="joystickKnob" style="width:50px; height:50px; border-radius:50%; background:rgba(29,185,84,0.7); border:2px solid rgba(29,185,84,0.9); position:absolute; top:35px; left:35px;"></div>
        </div>
      </div>
      <div style="position:absolute; bottom:20px; right:20px; display:flex; flex-direction:column; gap:10px; pointer-events:all; align-items:flex-end;">
        <button id="mobileNitroBtn" style="width:64px; height:64px; border-radius:50%; background:rgba(255,102,0,0.8); border:2px solid #ff6600; color:white; font-size:22px; display:flex; align-items:center; justify-content:center; cursor:pointer;">âš¡</button>
        <div style="display:flex; gap:8px;">
          <button id="mobileShootBtn" style="width:56px; height:56px; border-radius:50%; background:rgba(255,50,50,0.8); border:2px solid #ff3232; color:white; font-size:20px; display:flex; align-items:center; justify-content:center; cursor:pointer;">ğŸ”«</button>
          <button id="mobileDriftBtn" style="width:56px; height:56px; border-radius:50%; background:rgba(100,100,255,0.8); border:2px solid #6464ff; color:white; font-size:20px; display:flex; align-items:center; justify-content:center; cursor:pointer;">ğŸ’¨</button>
        </div>
      </div>
    </div>

    <!-- SELECTOR DE DIFICULTAD -->
    <div id="difficultyPanel" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:220; align-items:center; justify-content:center; backdrop-filter:blur(5px);">
      <div style="background:rgba(15,22,35,0.98); border:2px solid rgba(29,185,84,0.4); border-radius:16px; padding:36px 28px; text-align:center; max-width:500px; width:95%;">
        <h2 style="color:#1db954; margin:0 0 6px;">âš”ï¸ Dificultad</h2>
        <p style="color:#bfc8d0; margin:0 0 24px; font-size:13px;">Afecta velocidad de zombies, daÃ±o y multiplicador de puntuaciÃ³n</p>
        <div id="difficultyOptions" style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;"></div>
        <button class="btn" id="closeDifficultyPanel">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Three.js y dependencias -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/postprocessing/RenderPass.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/postprocessing/UnrealBloomPass.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/postprocessing/ShaderPass.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/shaders/FXAAShader.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/postprocessing/FilmPass.js"></script>
  
  <!-- AnimaciÃ³n de fondo del menÃº -->
  <script>
    // AnimaciÃ³n de partÃ­culas en el fondo del menÃº
    (function() {
      const canvas = document.getElementById('bgCanvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      let particles = [];
      let w, h;

      function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
      }

      class Particle {
        constructor() {
          this.x = Math.random() * w;
          this.y = Math.random() * h;
          this.vx = (Math.random() - 0.5) * 0.5;
          this.vy = (Math.random() - 0.5) * 0.5;
          this.size = Math.random() * 2 + 1;
          this.opacity = Math.random() * 0.5 + 0.2;
        }

        update() {
          this.x += this.vx;
          this.y += this.vy;

          if (this.x < 0 || this.x > w) this.vx *= -1;
          if (this.y < 0 || this.y > h) this.vy *= -1;
        }

        draw() {
          ctx.fillStyle = `rgba(29, 185, 84, ${this.opacity})`;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      function init() {
        resize();
        particles = [];
        for (let i = 0; i < 80; i++) {
          particles.push(new Particle());
        }
      }

      function animate() {
        ctx.fillStyle = 'rgba(10, 14, 20, 0.1)';
        ctx.fillRect(0, 0, w, h);

        particles.forEach(p => {
          p.update();
          p.draw();
        });

        // Conexiones entre partÃ­culas cercanas
        for (let i = 0; i < particles.length; i++) {
          for (let j = i + 1; j < particles.length; j++) {
            const dx = particles[i].x - particles[j].x;
            const dy = particles[i].y - particles[j].y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            if (dist < 150) {
              ctx.strokeStyle = `rgba(29, 185, 84, ${0.2 * (1 - dist / 150)})`;
              ctx.lineWidth = 0.5;
              ctx.beginPath();
              ctx.moveTo(particles[i].x, particles[i].y);
              ctx.lineTo(particles[j].x, particles[j].y);
              ctx.stroke();
            }
          }
        }

        requestAnimationFrame(animate);
      }

      window.addEventListener('resize', resize);
      init();
      animate();
    })();
  </script>
  
  <!-- AplicaciÃ³n principal ULTRA -->
  <script src="app.js"></script>
</body>
</html>